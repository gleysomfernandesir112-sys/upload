<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Fast - IPTV</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#141414">
    <link rel="manifest" href="/manifest.json">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>

    <style>
        :root {
            --primary-color: #E50914;
            --background-color: #141414;
            --text-color: #ffffff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Roboto', sans-serif; 
            background-color: var(--background-color); 
            color: var(--text-color); 
            overflow-x: hidden;
            padding-top: 60px;
        }
        
        #login-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://image.tmdb.org/t/p/original/VlHt2blBkncfAqPnuTtraG2flp.jpg') no-repeat center center/cover; }
        .app-wrapper { display: none; }
        .app-container { width: 100%; min-height: 100vh; padding-bottom: 80px; }
        
        .login-box { background-color: rgba(0,0,0,0.85); padding: 2rem; border-radius: 8px; max-width: 450px; width: 90%; }
        .login-box h1 { text-align: center; margin-bottom: 2rem; }
        .login-form-button { width: 100%; padding: 1rem; border: 1px solid var(--primary-color); background: transparent; color: var(--text-color); border-radius: 5px; font-size: 1rem; font-weight: 700; cursor: pointer; }
        .login-form { display: flex; flex-direction: column; gap: 1rem; }
        .login-form input { background-color: #333; border: none; border-radius: 5px; color: white; padding: 1rem; font-size: 1rem; }
        .login-form button { background-color: var(--primary-color); color: white; border: none; border-radius: 5px; padding: 1rem; font-size: 1.2rem; font-weight: 700; cursor: pointer; margin-top: 1.5rem; }
        #login-error { color: #e87c03; margin-top: 1rem; text-align: center; min-height: 1.2em; }

        .page { display: none; }
        .page.active { display: block; }
        .player-page.active { display: flex; }
        .generic-page { padding: 1rem 5%; }

        .mobile-header { display: flex; align-items: center; justify-content: center; position: fixed; top: 0; left: 0; width: 100%; background-color: rgba(20, 20, 20, 0.85); backdrop-filter: blur(10px); z-index: 101; padding: 1rem 1rem 0.75rem; padding-top: env(safe-area-inset-top, 1rem); border-bottom: 1px solid #333; }
        .mobile-header h1 { font-size: 1.2rem; font-weight: 500; }

        .navbar-desktop { display: none; position: fixed; top: 0; width: 100%; padding: 1rem 3rem; background: linear-gradient(180deg, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0) 100%); align-items: center; z-index: 100; }
        .navbar-desktop .logo { color: var(--primary-color); font-size: 1.8rem; font-weight: 700; margin-right: 2rem; }
        .navbar-desktop .nav-links { list-style: none; display: flex; gap: 1.5rem; flex-grow: 1; }
        .navbar-desktop .nav-link a { color: var(--text-color); text-decoration: none; font-size: 1rem; }
        .navbar-desktop .profile a { display: flex; align-items: center; }

        .navbar-mobile { position: fixed; bottom: 0; left: 0; width: 100%; height: 70px; background-color: rgba(20, 20, 20, 0.85); backdrop-filter: blur(10px); display: flex; justify-content: space-around; align-items: center; z-index: 100; border-top: 1px solid #333; padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { background: none; border: none; color: #8e8e8e; display: flex; flex-direction: column; align-items: center; gap: 4px; font-size: 0.7rem; cursor: pointer; flex-grow: 1; }
        .nav-item img { width: 24px; height: 24px; filter: invert(58%); }
        .nav-item.active { color: var(--text-color); }
        .nav-item.active img { filter: none; }
        
        .media-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px; }
        .media-card { flex-basis: auto; aspect-ratio: 10 / 16; border-radius: 8px; overflow: hidden; cursor: pointer; transition: transform 0.3s ease; position: relative; background-color: #222; }
        .media-card img { width: 100%; height: 100%; object-fit: cover; }
        .media-card:hover { transform: scale(1.05); }
        .media-card-title { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.7); font-size: 0.8rem; padding: 5px; text-overflow: ellipsis; overflow: hidden; white-space: nowrap; }
        .hero-section { height: 60vh; display: flex; flex-direction: column; justify-content: flex-end; padding: 0 5% 5rem; position: relative; background-size: cover; background-position: center center; }
        .hero-title { font-size: 2.5rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); }

        .promo-banner { display: flex; flex-direction: column; justify-content: space-between; align-items: center; background: linear-gradient(135deg, rgba(40, 40, 40, 0.8), rgba(20, 20, 20, 0.9)); border: 1px solid #333; border-radius: 8px; margin: 2rem 5%; padding: 1.5rem; gap: 1rem; }
        .promo-content h2 { font-size: 1.5rem; color: var(--text-color); margin-bottom: 0.5rem; }
        .promo-content p { color: #ccc; margin-bottom: 1rem; font-size: 0.9rem; }
        .promo-features { list-style: none; padding: 0; display: flex; flex-wrap: wrap; gap: 0.8rem; font-size: 0.8rem; color: #b3b3b3; }
        .promo-features li { display: flex; align-items: center; gap: 0.5rem; }
        .promo-features svg { width: 16px; height: 16px; fill: #2ecc71; }
        .promo-action { text-align: center; }
        .promo-price { font-size: 2rem; font-weight: 700; color: var(--text-color); margin-bottom: 0.5rem; }
        .promo-price span { font-size: 1rem; font-weight: 400; color: #ccc; }
        .promo-button { display: inline-block; background-color: var(--primary-color); color: white; text-decoration: none; padding: 0.75rem 2rem; border-radius: 5px; font-weight: 700; transition: background-color 0.2s; }
        .promo-button:hover { background-color: #f40612; }

        .player-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #000; z-index: 200; align-items: center; justify-content: center; }
        .player-page video { max-width: 100%; max-height: 100%; outline: none; }
        .back-from-player { position: absolute; top: 2rem; left: 2rem; background: rgba(0,0,0,0.5); border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 10; }
        .back-from-player svg { width: 25px; height: 25px; fill: white; }

        #page-profile h2 { margin-bottom: 1.5rem; }
        .logout-button { width: 100%; max-width: 400px; display: block; margin: 0 auto; background-color: var(--primary-color); color: white; border: none; border-radius: 5px; padding: 1rem; font-size: 1.2rem; font-weight: 700; cursor: pointer; }
        #page-profile .layout-switcher { margin-top: 2rem; border-top: 1px solid #444; padding-top: 1.5rem; }
        #page-profile .layout-switcher h3 { margin-bottom: 1rem; }
        #page-profile .layout-buttons { display: flex; gap: 1rem; flex-wrap: wrap; }
        #page-profile .layout-buttons button { padding: 0.8rem 1.2rem; border: 1px solid #555; background: #333; color: white; border-radius: 5px; cursor: pointer; font-size: 0.9rem; }
        #page-profile .layout-buttons button.active { background: var(--primary-color); border-color: var(--primary-color); font-weight: bold; }
        
        #page-qr-login { text-align: center; display: none; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 110; }
        #qr-code-container { width: 200px; height: 200px; margin: 1.5rem auto; background: white; padding: 1rem; border-radius: 8px; }
        #qr-code-container img { width: 100%; height: 100%; }
        #tv-code-display { font-size: 2rem; font-weight: 700; letter-spacing: 0.3rem; background: #333; padding: 0.8rem; border-radius: 5px; display: inline-block; margin-top: 1rem; }
        #back-to-login-btn { margin-top: 2rem; width: 100%; max-width: 300px; }

        .layout-desktop body, .layout-tv body { padding-top: 0; }
        .layout-desktop .mobile-header, .layout-tv .mobile-header, .layout-desktop .navbar-mobile, .layout-tv .navbar-mobile { display: none; }
        .layout-desktop .app-container, .layout-tv .app-container { padding-bottom: 0; }
        .layout-desktop .navbar-desktop, .layout-tv .navbar-desktop { display: flex; }
        .layout-desktop .media-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
        .layout-desktop .generic-page, .layout-tv .generic-page { padding-top: 6rem; }
        .layout-desktop .promo-banner, .layout-tv .promo-banner { flex-direction: row; text-align: left; }
        .layout-desktop .promo-action, .layout-tv .promo-action { text-align: right; min-width: 200px; }
        
        .layout-tv { font-size: 1.2rem; }
        .layout-tv .media-grid { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 20px; padding-bottom: 20px; scrollbar-width: none; }
        .layout-tv .media-grid::-webkit-scrollbar { display: none; }
        .layout-tv .media-card { flex: 0 0 320px; aspect-ratio: 16 / 9; }
        .layout-tv *:focus { outline: 4px solid var(--primary-color); outline-offset: 4px; transform: scale(1.08); z-index: 10; }
        
        @media (min-width: 768px) {
            body:not([class*="layout-"]) { padding-top: 0; }
            body:not([class*="layout-"]) .mobile-header, body:not([class*="layout-"]) .navbar-mobile { display: none; }
            body:not([class*="layout-"]) .app-container { padding-bottom: 0; }
            body:not([class*="layout-"]) .navbar-desktop { display: flex; }
            body:not([class*="layout-"]) .media-grid { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
            body:not([class*="layout-"]) .generic-page { padding-top: 6rem; }
            body:not([class*="layout-"]) .promo-banner { flex-direction: row; text-align: left; }
            body:not([class*="layout-"]) .promo-action { text-align: right; min-width: 200px; }
        }
        
        @media (min-width: 1280px) {
            body:not([class*="layout-"]) { font-size: 1.2rem; }
            body:not([class*="layout-"]) .media-grid { display: flex; flex-wrap: nowrap; overflow-x: auto; gap: 20px; padding-bottom: 20px; scrollbar-width: none; }
            body:not([class*="layout-"]) .media-grid::-webkit-scrollbar { display: none; }
            body:not([class*="layout-"]) .media-card { flex: 0 0 320px; aspect-ratio: 16/9; }
        }
    </style>
</head>
<body>
    <div id="login-container">
        <div id="page-qr-login" class="page">
            <h2>Login pela Câmera do Celular</h2>
            <p>1. Aponte a câmera do seu celular para o QR Code.</p>
            <p>2. Digite seus dados na página que abrir.</p>
            <div id="qr-code-container"></div>
            <p style="margin-top: 2rem;">Seu código de login único:</p>
            <div id="tv-code-display"></div>
            <button id="back-to-login-btn" class="login-form-button">Voltar ao Login Manual</button>
        </div>
        <div class="login-box">
            <h1>Entrar</h1>
            <button id="show-qr-btn" class="login-form-button">Entrar com QR Code (TV)</button>
            <p style="text-align: center; margin: 1rem 0;">- OU -</p>
            <h2 style="text-align: center; margin-bottom: 1.5rem; font-size: 1.2rem;">Entrar com API Xtream</h2>
            <form id="xtream-form" class="login-form active">
                <input type="text" id="xtream-url" placeholder="URL do Servidor" required>
                <input type="text" id="xtream-user" placeholder="Usuário" required>
                <input type="password" id="xtream-pass" placeholder="Senha" required>
                <button type="submit">Entrar</button>
            </form>
            <div id="login-error"></div>
        </div>
    </div>

    <div class="app-wrapper">
        <header class="mobile-header">
            <h1 id="mobile-page-title">Início</h1>
        </header>
        <div class="app-container">
            <nav class="navbar-desktop">
                <div class="logo">FAST IPTV</div>
                <ul class="nav-links">
                    <li class="nav-link"><a href="#" data-page="home">Início</a></li>
                    <li class="nav-link"><a href="#" data-page="series">Séries</a></li>
                    <li class="nav-link"><a href="#" data-page="movies">Filmes</a></li>
                    <li class="nav-link"><a href="#" data-page="iptv">Ao Vivo</a></li>
                </ul>
                <div class="profile"> 
                    <a href="#" data-page="profile">
                        <img src="https://i.pravatar.cc/40" alt="Perfil">
                    </a>
                </div>
            </nav>

            <main class="main-content">
                <div id="page-home" class="page"></div>
                <div id="page-series" class="page generic-page"><div id="series-content" class="media-grid"></div></div>
                <div id="page-movies" class="page generic-page"><div id="movies-content" class="media-grid"></div></div>
                <div id="page-iptv" class="page generic-page"><div id="iptv-content" class="media-grid"></div></div>
                <div id="page-profile" class="page generic-page">
                    <h2>Perfil e Configurações</h2>
                    <button id="mobile-logout-btn" class="logout-button">Sair da Conta</button>
                    <div class="layout-switcher">
                        <h3>Forçar Modo de Exibição</h3>
                        <div class="layout-buttons">
                            <button data-layout="auto" class="active">Automático</button>
                            <button data-layout="mobile">Celular</button>
                            <button data-layout="desktop">Desktop</button>
                            <button data-layout="tv">TV</button>
                        </div>
                    </div>
                </div>
                 <div id="page-series-details" class="page">
                    </div>
                 <div id="page-player" class="page player-page">
                    <button class="back-from-player" tabindex="0">
                        <svg viewBox="0 0 24 24"><path d="M15.41 16.59L10.83 12l4.58-4.59L14 6l-6 6 6 6 1.41-1.41z"></path></svg>
                    </button>
                    <video controls autoplay></video>
                </div>
            </main>
            
            <nav class="navbar-mobile">
                 <button class="nav-item" data-page="home"> <img src="https://img.icons8.com/fluency-systems-filled/48/ffffff/home.png" alt="Início"/> <span>Início</span> </button>
                <button class="nav-item" data-page="series"> <img src="https://img.icons8.com/fluency-systems-filled/48/ffffff/tv-show.png" alt="Séries"/> <span>Séries</span> </button>
                <button class="nav-item" data-page="movies"> <img src="https://img.icons8.com/fluency-systems-filled/48/ffffff/movie-projector.png" alt="Filmes"/> <span>Filmes</span> </button>
                <button class="nav-item" data-page="iptv"> <img src="https://img.icons8.com/fluency-systems-filled/48/ffffff/playlist.png" alt="IPTV"/> <span>Ao Vivo</span> </button>
                <button class="nav-item" data-page="profile"> <img src="https://img.icons8.com/fluency-systems-filled/48/ffffff/user-male-circle.png" alt="Perfil"/> <span>Perfil</span> </button>
            </nav>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const firebaseConfig = {
          apiKey: "AIzaSyCY9sq12w7H9X3hm9FLa_KkazKONpm1nJE",
          authDomain: "fasthub-9a206.firebaseapp.com",
          databaseURL: "https://fasthub-9a206-default-rtdb.firebaseio.com",
          projectId: "fasthub-9a206",
          storageBucket: "fasthub-9a206.appspot.com",
          messagingSenderId: "685686875831",
          appId: "1:685686875831:web:035d9deb8596e4a3b88f32"
        };

        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        
        let loginListener = null;

        const loginContainer = document.getElementById('login-container');
        const appWrapper = document.querySelector('.app-wrapper');
        const pages = document.querySelectorAll('.page');
        const mobileLinks = document.querySelectorAll('.navbar-mobile .nav-item');
        const desktopLinks = document.querySelectorAll('.navbar-desktop .nav-links .nav-link, .navbar-desktop .profile a');
        const mobileLogoutBtn = document.getElementById('mobile-logout-btn');
        const xtreamForm = document.getElementById('xtream-form');
        const loginError = document.getElementById('login-error');
        const layoutButtons = document.querySelectorAll('.layout-buttons button');
        const showQrBtn = document.getElementById('show-qr-btn');
        const backToLoginBtn = document.getElementById('back-to-login-btn');
        const qrContainer = document.getElementById('qr-code-container');
        const tvCodeDisplay = document.getElementById('tv-code-display');
        const qrLoginPage = document.getElementById('page-qr-login');
        const loginBox = document.querySelector('.login-box');
        const mobilePageTitle = document.getElementById('mobile-page-title');
        const videoPlayer = document.querySelector('#page-player video');
        const backFromPlayerBtn = document.querySelector('.back-from-player');
        
        let activeUser = null;
        let lastPageId = 'home';
        let appData = { vodStreams: [], series: [], liveStreams: [] };
        let hls = null;

        function applyLayoutMode(mode) {
            document.body.className = '';
            if (mode && mode !== 'auto') {
                document.body.classList.add(`layout-${mode}`);
            }
            layoutButtons.forEach(btn => {
                btn.classList.toggle('active', btn.dataset.layout === mode);
            });
            localStorage.setItem('forcedLayout', mode || 'auto');
        }

        layoutButtons.forEach(button => {
            button.addEventListener('click', () => {
                applyLayoutMode(button.dataset.layout);
            });
        });

        showQrBtn.addEventListener('click', () => {
            loginBox.style.display = 'none';
            qrLoginPage.style.display = 'flex';
            
            const tvCode = Math.floor(100000 + Math.random() * 900000).toString();
            tvCodeDisplay.textContent = tvCode;
            
            const loginPageUrl = `http://app.fasthub.cloud/login-mobile.html?code=${tvCode}`;
            
            const qr = qrcode(0, 'L');
            qr.addData(loginPageUrl);
            qr.make();
            qrContainer.innerHTML = qr.createImgTag(10);
            
            listenForLogin(tvCode);
        });

        backToLoginBtn.addEventListener('click', () => {
            loginBox.style.display = 'block';
            qrLoginPage.style.display = 'none';
            if (loginListener) {
                loginListener.off();
            }
        });

        function listenForLogin(code) {
            const loginRef = database.ref('logins/' + code);
            loginListener = loginRef;
            
            loginRef.on('value', (snapshot) => {
                const data = snapshot.val();
                if (data && data.url) {
                    loginRef.off();
                    loginRef.remove();
                    loginWithXtream(data.url, data.user, data.pass);
                }
            });
        }

        xtreamForm.addEventListener('submit', (e) => { 
            e.preventDefault(); 
            loginWithXtream(
                document.getElementById('xtream-url').value.trim(), 
                document.getElementById('xtream-user').value.trim(), 
                document.getElementById('xtream-pass').value.trim()
            ); 
        });
        
        async function fetchAPI(url) {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            return response;
        }

        async function fetchXtreamData(url, user, pass, action) {
            const targetUrl = `${url}/player_api.php?username=${user}&password=${pass}&action=${action}`;
            const response = await fetchAPI(targetUrl);
            const textData = await response.text();
            try {
                if (textData.trim() === '[]') return [];
                return JSON.parse(textData);
            } catch (e) {
                throw new Error('Resposta inválida do servidor (não é JSON).');
            }
        }

        async function loginWithXtream(url, user, pass) {
            loginError.textContent = '';
            try {
                await fetchXtreamData(url, user, pass, 'get_user_info');
                const [liveStreams, vodStreams, series] = await Promise.all([
                    fetchXtreamData(url, user, pass, 'get_live_streams'),
                    fetchXtreamData(url, user, pass, 'get_vod_streams'),
                    fetchXtreamData(url, user, pass, 'get_series'),
                ]);
                initializeApp({ liveStreams, vodStreams, series }, { type: 'xtream', url, user, pass });
            } catch (error) {
                loginError.textContent = error.message;
            }
        }

        function initializeApp(data, user) {
            appData = data;
            activeUser = user;
            localStorage.setItem('streamflix_session', JSON.stringify(activeUser));
            loginContainer.style.display = 'none';
            appWrapper.style.display = 'block';
            renderHomePage();
            renderGridPage('movies', appData.vodStreams);
            renderGridPage('series', appData.series);
            renderGridPage('iptv', appData.liveStreams);
            showPage('home');
        }
        
        function renderHomePage() {
            const pageHome = document.getElementById('page-home');
            const firstItem = appData.vodStreams?.[0] || appData.series?.[0] || appData.liveStreams?.[0];
            if (!firstItem) {
                pageHome.innerHTML = '<div class="generic-page"><h2>Nenhum conteúdo disponível.</h2></div>';
                return;
            }
            const title = firstItem.name;
            const image = firstItem.stream_icon || firstItem.cover;

            const promoBannerHtml = `
                <section class="promo-banner">
                    <div class="promo-content">
                        <h2>Assine Nosso Plano Premium</h2>
                        <p>Acesso ilimitado a mais de 300 mil conteúdos, suporte 24/7 e muito mais.</p>
                        <ul class="promo-features">
                            <li><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg>Suporte 24/7</li>
                            <li><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg>+300 mil conteúdos</li>
                            <li><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path></svg>App para TV, Celular e PC</li>
                        </ul>
                    </div>
                    <div class="promo-action">
                        <div class="promo-price">R$ 25,00 <span>/mês</span></div>
                        <a href="https://wa.me/5551992792797" target="_blank" class="promo-button">Fale Conosco</a>
                    </div>
                </section>
            `;

            pageHome.innerHTML = `
                <header class="hero-section" style="background-image: linear-gradient(to top, #141414 10%, transparent 50%), url('${image}');">
                    <div class="hero-content">
                        <h1 class="hero-title">${title}</h1>
                    </div>
                </header>
                ${promoBannerHtml}
            `;
        }
        
        function renderGridPage(pageId, items) {
            const container = document.getElementById(`${pageId}-content`);
            if (!container) return;
            const cardsHtml = items.map(item => createCardHtml(item, pageId)).join('');
            container.innerHTML = cardsHtml;
        }

        function createCardHtml(item, pageId) {
            const streamId = item.stream_id || item.series_id;
            const title = item.name;
            const image = item.stream_icon || item.cover;
            let streamUrl = '';
            let seriesId = '';

            if (activeUser.type === 'xtream') {
                streamUrl = pageId === 'movies' ? `${activeUser.url}/movie/${activeUser.user}/${activeUser.pass}/${streamId}.${item.container_extension}` : (pageId === 'iptv' ? `${activeUser.url}/live/${activeUser.user}/${activeUser.pass}/${streamId}.ts` : '');
                seriesId = pageId === 'series' ? streamId : '';
            }
            return `<div class="media-card" data-stream-url="${streamUrl}" data-series-id="${seriesId}" tabindex="0"><img src="${image}" alt="${title}"><div class="media-card-title">${title}</div></div>`;
        }

        function showPage(pageId) {
            if (pageId && pageId !== 'player') lastPageId = pageId;
            pages.forEach(p => p.classList.remove('active'));
            const newPage = document.getElementById(`page-${pageId}`);
            if (newPage) newPage.classList.add('active');

            const titleMap = { home: 'Início', series: 'Séries', movies: 'Filmes', iptv: 'Ao Vivo', profile: 'Perfil' };
            mobilePageTitle.textContent = titleMap[pageId] || 'Início';

            [...mobileLinks, ...desktopLinks].forEach(link => {
                const linkElement = link.matches('a') ? link : link;
                const linkPage = linkElement.dataset.page;
                linkElement.classList.toggle('active', linkPage === pageId);
            });
        }

        function openPlayer(streamUrl) {
            if (!streamUrl) return;
            if (hls) { hls.destroy(); hls = null; }

            const isHls = streamUrl.includes('.m3u8') || streamUrl.includes('.ts');

            if (isHls && Hls.isSupported()) {
                hls = new Hls();
                hls.loadSource(streamUrl);
                hls.attachMedia(videoPlayer);
            } else {
                videoPlayer.src = streamUrl;
            }
            
            videoPlayer.load();
            showPage('player');
            videoPlayer.play();
        }

        backFromPlayerBtn.addEventListener('click', () => {
            showPage(lastPageId);
            videoPlayer.pause();
            videoPlayer.src = '';
            if (hls) { hls.destroy(); hls = null; }
        });
        
        function logout() {
            localStorage.removeItem('streamflix_session');
            localStorage.removeItem('forcedLayout');
            window.location.reload();
        }

        [...mobileLinks, ...desktopLinks].forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(link.dataset.page);
            });
        });

        mobileLogoutBtn.addEventListener('click', logout);
        
        const savedLayoutOnLoad = localStorage.getItem('forcedLayout') || 'auto';
        applyLayoutMode(savedLayoutOnLoad);
        
        // checkSession();
    });
    </script>
</body>
</html>
